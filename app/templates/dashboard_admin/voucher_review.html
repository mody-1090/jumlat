{# templates/dashboard_admin/voucher_review.html #}
{% extends "dashboard_admin/base.html" %}
{% block title %}Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ù†Ø¯Ø§Øª â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©{% endblock %}

{% block admin_content %}
<h2 class="mb-4">ğŸ“ Ø§Ù„Ø³Ù†Ø¯Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h2>

<!-- Ø²Ø± ØªÙØ¹ÙŠÙ„ / ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
<form method="POST" action="{{ url_for('admin.toggle_auto_approve') }}" style="display:inline;">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">   {# â† Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§ #}
  <button type="submit" class="btn btn-outline-primary">
    {% if auto_approve_enabled %}
      ğŸ”´ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    {% else %}
      âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    {% endif %}
  </button>
</form>

<!-- Ø²Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
<a href="{{ url_for('admin.auto_approve_now') }}" class="btn btn-success">
  ğŸ”„ ØªÙ†ÙÙŠØ° Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø¢Ù†
</a>

{% if vouchers %}
  {# â¶-- Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ø­Ø¯ ÙŠØºÙ„Ù‘Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ„Ù‡ #}
  <form method="post" action="{{ url_for('admin.review_voucher_action') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="table-responsive">
      <table class="table table-bordered table-hover text-center align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:1%">
              <input type="checkbox" id="select-all">
            </th>
            <th>Ø§Ù„Ø±Ù…Ø²</th>
            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ù…ØµÙ†Ø¹</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙØ±Ø¯ÙŠ</th>
          </tr>
        </thead>

        <tbody>
        {% for v in vouchers %}
          <tr>
            <td>
              <input type="checkbox" name="voucher_ids" value="{{ v.id }}" class="row-checkbox">
            </td>
            <td>{{ v.code }}</td>
            <td>{{ v.product }}</td>
            <td>{{ v.quantity }}</td>
            <td>{{ v.factory.name }}</td>

            <td>
              <!-- Ù‚Ø¨ÙˆÙ„ ÙØ±Ø¯ÙŠ -->
              <button name="action" value="approve_{{ v.id }}"
                      class="btn btn-success btn-sm">âœ” Ù‚Ø¨ÙˆÙ„</button>

              <!-- Ø±ÙØ¶ ÙØ±Ø¯ÙŠ â€“ ÙŠÙØªØ­ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ ØµØºÙŠØ± Ø¹Ø¨Ø± JS -->
              <button type="button"
                      class="btn btn-danger btn-sm"
                      onclick="openReason('{{ v.id }}');">âœ– Ø±ÙØ¶</button>

              <input type="text" name="reason_{{ v.id }}"
                     class="form-control form-control-sm d-none mt-1"
                     id="reason-{{ v.id }}"
                     placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶">
              <button name="action" value="reject_{{ v.id }}"
                      id="send-{{ v.id }}"
                      class="btn btn-danger btn-sm d-none mt-1">Ø¥Ø±Ø³Ø§Ù„</button>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    {# â·-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ #}
    <div class="mt-3">
      <button name="action" value="approve_bulk" class="btn btn-success">âœ” Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ù‘Ø¯</button>
      <button name="action" value="reject_bulk"  class="btn btn-danger">âœ– Ø±ÙØ¶ Ø§Ù„Ù…Ø­Ø¯Ù‘Ø¯</button>
    </div>
  </form>

  {# â¸-- Ø³ÙƒØ±Ø¨Øª Ø¨Ø³ÙŠØ· Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ + Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ #}
  <script>
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
    document.getElementById('select-all')
            .addEventListener('change', function () {
              document.querySelectorAll('.row-checkbox')
                      .forEach(cb => cb.checked = this.checked);
            });

    // ÙØªØ­ Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙØ±Ø¯ÙŠ
    function openReason(id) {
      document.getElementById('reason-' + id).classList.remove('d-none');
      document.getElementById('send-'   + id).classList.remove('d-none');
    }
  </script>

{% else %}
  <div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù†Ø¯Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</div>
{% endif %}
{% endblock %}
